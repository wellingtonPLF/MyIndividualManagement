CREATE TABLE USUARIO
(
  idUSUARIO SERIAL NOT NULL,
  nome varchar(45) NOT NULL,
  email varchar(45) NOT NULL,
  senha varchar(45) NOT NULL,
  img varchar(45) default 'userImg' NULL,
  token char(5),
  objectType varchar(20) default 'Usuario' NOT NULL;
  CONSTRAINT PK_USUARIO PRIMARY KEY (idUSUARIO),
  CONSTRAINT AK_USUARIO_email UNIQUE (email),
  CONSTRAINT CK_USUARIO_nome CHECK (char_length(nome) > 4),
  CONSTRAINT CK_USUARIO_email CHECK (email ~* '^[^\s@]+@[^\s@]+\.[^\s@]+$'),
  CONSTRAINT CK_USUARIO_senha_minLength CHECK (char_length(senha) > 7),
  CONSTRAINT CK_USUARIO_senha_specialCharacters CHECK (senha ~* '[^A-Za-z0-9]{3}'),
  CONSTRAINT CK_USUARIO_senha_hasNumber CHECK (senha ~* '\d'),
  CONSTRAINT CK_USUARIO_senha_capitalCase CHECK (senha ~* '[A-Z]'),
  CONSTRAINT CK_USUARIO_senha_smallCharacters CHECK (senha ~* '[a-z]')
);

CREATE TABLE ATIVIDADE
(
  idATIVIDADE SERIAL NOT NULL,
  nome varchar(45) NOT NULL,
  ordem INT NOT NULL,
  idusuario INT NOT NULL,
  objectType varchar(20) default 'Atividade' NOT NULL;
  CONSTRAINT PK_ATIVIDADE PRIMARY KEY (idATIVIDADE),
  CONSTRAINT FK_ATIVIDADE_USUARIO FOREIGN KEY (idusuario) REFERENCES USUARIO
);

CREATE TABLE JANELA
(
  idJANELA SERIAL NOT NULL,
  nome VARCHAR(45) NOT NULL,
  ordem INT NOT NULL,
  idatividade INT NOT NULL,
  objectType varchar(20) default 'Janela' NOT NULL;
  CONSTRAINT PK_JANELA PRIMARY KEY (idJANELA)
  CONSTRAINT FK_JANELA_ATIVIDADE FOREIGN KEY (idatividade) REFERENCES ATIVIDADE
);

CREATE TABLE TEMPLATE
(
  idTEMPLATE SERIAL NOT NULL,
  nome VARCHAR(45) NOT NULL,
  objectType varchar(20) default 'Template' NOT NULL;
  CONSTRAINT PK_TEMPLATE PRIMARY KEY (idTEMPLATE)
)

CREATE TABLE USUARIO_TEMPLATE
(
  idTEMPLATE INT NOT NULL,
  idUsuario INT NOT NULL,
  objectType varchar(20) default 'UsuarioTemplate' NOT NULL;
  CONSTRAINT PK_USUARIO_TEMPLATE PRIMARY KEY (idTEMPLATE, idUsuario),
  CONSTRAINT FK_USUARIO_TEMPLATE_TEMPLATE FOREIGN KEY (idTEMPLATE) REFERENCES TEMPLATE
  CONSTRAINT FK_USUARIO_TEMPLATE_USUARIO FOREIGN KEY (idUSUARIO) REFERENCES USUARIO
)

CREATE TABLE SUBAREA
(
  idSUBAREA SERIAL NOT NULL,
  nome VARCHAR(45) NOT NULL,
  ordem INT NOT NULL,
  idTEMPLATE INT NOT NULL,
  objectType varchar(20) default 'Subarea' NOT NULL;
  CONSTRAINT PK_SUBAREA PRIMARY KEY (idSUBAREA),
  CONSTRAINT FK_SUBAREA_TEMPLATE FOREIGN KEY (idTEMPLATE) REFERENCES TEMPLATE
);

CREATE TABLE OCUPACAO
(
  idOCUPACAO SERIAL NOT NULL,
  nome VARCHAR(45) NOT NULL,
  ordem INT NOT NULL,
  objectType varchar(20) default 'Ocupacao' NOT NULL;
  CONSTRAINT PK_OCUPACAO PRIMARY KEY (idOCUPACAO)
);

CREATE TABLE SUB_OCUP
(
  idOCUPACAO INT NOT NULL,
  idSUBAREA INT NOT NULL,
  objectType varchar(20) default 'SubOcup' NOT NULL;
  CONSTRAINT PK_SUB_OCUP PRIMARY KEY (idOCUPACAO, idSUBAREA),
  CONSTRAINT FK_SUB_OCUP_OCUPACAO FOREIGN KEY (idOCUPACAO) REFERENCES OCUPACAO,
  CONSTRAINT FK_SUB_OCUP_SUBAREA FOREIGN KEY (idSUBAREA) REFERENCES SUBAREA
);

CREATE TABLE CLASSE
(
  idCLASSE SERIAL NOT NULL,
  nome VARCHAR(45) NOT NULL,
  ordem INT NOT NULL,
  objetivo TEXT NULL,
  porque TEXT NULL,
  oque TEXT NULL,
  como TEXT NULL,
  idOCUPACAO INT NOT NULL,
  objectType varchar(20) default 'Classe' NOT NULL;
  CONSTRAINT PK_CLASSE PRIMARY KEY (idCLASSE),
  CONSTRAINT FK_CLASSE_OCUPACAO FOREIGN KEY (idOCUPACAO) REFERENCES OCUPACAO
);

CREATE TABLE TASK
(
  idTASK SERIAL NOT NULL,
  nome VARCHAR(45) NOT NULL,
  ordem INT NOT NULL,
  data DATE NOT NULL,
  tempo TIMESTAMP NOT NULL,
  descricao TEXT NULL,
  comentario TEXT NULL,
  etiqueta VARCHAR(45) NOT NULL,
  idCLASSE INT NOT NULL,
  idENCADEAMENTO INT NOT NULL,
  objectType varchar(20) default 'Task' NOT NULL;
  CONSTRAINT PK_TASK PRIMARY KEY (idTASK),
  CONSTRAINT FK_TASK_CLASSE FOREIGN KEY (idCLASSE) REFERENCES CLASSE,
  CONSTRAINT FK_TASK_ENCADEAMENTO FOREIGN KEY (idENCADEAMENTO) REFERENCES TASK
);

CREATE TABLE CASUAL
(
  idTASK INT NOT NULL,
  descricao TEXT NULL,
  CONSTRAINT PK_CASUALTASK PRIMARY KEY (idTASK),
  CONSTRAINT FK_TASK_CASUAL FOREIGN KEY (idTASK) REFERENCES TASK
);

CREATE TABLE PROJETO
(
  idTASK INT NOT NULL,
  planning TEXT NULL,
  fazer TEXT NULL,
  pendencia TEXT NULL,
  analise TEXT NULL,
  conclusao TEXT NULL,
  CONSTRAINT PK_PROJETOTASK PRIMARY KEY (idTASK),
  CONSTRAINT FK_TASK_PROJETO FOREIGN KEY (idTASK) REFERENCES TASK
);



